<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000">
  <link rel="manifest" href="manifest.json">
  <meta name="screen-orientation" content="landscape">
  <meta name="x5-orientation" content="landscape">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <title>Work Timer</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --muted: #9aa0a6;
      --accent: #67C7ED;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(180deg, #000 0%, #070707 100%);
      color: var(--fg);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Helvetica Neue", Arial;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      box-sizing: border-box;
      overflow: hidden;
    }

    .card {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: transparent;
      padding: 20px;
      box-sizing: border-box;
    }

    .clock {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
      height: 100%;
      padding: 20px;
      box-sizing: border-box;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 0;
    }

    .top-row {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      padding: 0 10px;
      box-sizing: border-box;
    }

    .mode-badge {
      font-weight: 800;
      color: var(--muted);
      font-size: 14px;
    }

    .switch-btn {
      margin-left: 6px;
      padding: 8px 12px;
      border-radius: 8px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--fg);
      cursor: pointer;
      font-weight: 700;
    }

    .time {
      font-size: clamp(48px, 14vw, 120px);
      font-weight: 900;
      line-height: 1;
      color: var(--fg);
      text-shadow: 0 6px 30px rgba(0, 0, 0, 0.8);
      margin: 10px 0;
      user-select: none;
    }

    .label {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .set-area,
    .controls,
    .quick {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    button,
    input[type=number] {
      background: #111;
      color: var(--fg);
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
    }

    button.primary {
      background: var(--accent);
      color: #010101;
      border: none;
    }

    button.ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .meta {
      color: var(--muted);
      font-size: 13px;
      text-align: center;
      margin-top: 10px;
    }

    /* Landscape Mobile: Fullscreen, vertical stacking */
    @media (max-width: 900px) and (orientation: landscape) {

      html,
      body {
        height: 100vh;
        overflow: hidden;
      }

      .card,
      .clock {
        height: 100vh;
        width: 100vw;
        border-radius: 0;
      }

      .clock {
        flex-direction: column;
        justify-content: space-evenly;
      }

      .time {
        font-size: clamp(48px, 18vw, 140px);
      }

      .set-area,
      .controls,
      .quick {
        flex-direction: column;
        gap: 14px;
      }

      button,
      input[type=number] {
        font-size: 16px;
      }

      .top-row {
        justify-content: center;
      }
    }

    /* Portrait Mobile */
    @media (max-width: 600px) and (orientation: portrait) {

      html,
      body {
        height: 100vh;
        overflow: hidden;
      }

      .card,
      .clock {
        height: 100vh;
        width: 100vw;
        border-radius: 0;
      }

      .clock {
        justify-content: space-evenly;
      }

      .time {
        font-size: clamp(48px, 20vw, 120px);
      }

      .set-area,
      .controls,
      .quick {
        flex-direction: column;
        gap: 12px;
      }

      button,
      input[type=number] {
        font-size: 16px;
      }

      .top-row {
        justify-content: center;
      }
    }

    /* Desktop: keep label and switch inline */
    @media (min-width: 901px) {
      .top-row {
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <main class="card">
    <div class="clock" aria-live="polite">
      <div class="top-row">
        <div class="label mode-badge" id="modeLabel">Mode: <strong id="modeName">Countdown</strong></div>
        <button id="switchMode" class="switch-btn ghost" title="Switch mode">Switch to Stopwatch</button>
      </div>

      <div id="display" class="time">00:00:00</div>

      <!-- SET AREA (only for countdown) -->
      <div class="set-area" id="countdownControls">
        <label style="color:var(--muted);font-weight:700;">Hours:</label>
        <input id="hours" type="number" min="0" max="999" value="1" />
        <label style="color:var(--muted);font-weight:700;">Minutes:</label>
        <input id="minutes" type="number" min="0" max="59" value="0" />
        <button id="setBtn" class="small ghost">Set</button>
      </div>

      <!-- SHARED CONTROLS -->
      <div class="controls">
        <button id="startBtn" class="primary">Start</button>
        <button id="pauseBtn" class="ghost">Pause</button>
        <button id="resetBtn" class="ghost">Reset</button>
        <div class="quick" id="quickButtons">
          <button id="add15" class="ghost small">+15m</button>
          <button id="add30" class="ghost small">+30m</button>
          <button id="add60" class="ghost small">+1h</button>
        </div>
      </div>

      <div class="meta" id="status">Ready â€” set a duration and press Start.</div>
    </div>
  </main>

  <script>
    // Elements
    const display = document.getElementById('display');
    const hoursInput = document.getElementById('hours');
    const minutesInput = document.getElementById('minutes');
    const setBtn = document.getElementById('setBtn');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const add15 = document.getElementById('add15');
    const add30 = document.getElementById('add30');
    const add60 = document.getElementById('add60');
    const status = document.getElementById('status');
    const switchModeBtn = document.getElementById('switchMode');
    const modeName = document.getElementById('modeName');
    const countdownControls = document.getElementById('countdownControls');

    // State
    let mode = 'countdown';
    let duration = 0;
    let remaining = 0;
    let elapsed = 0;
    let timer = null;
    let running = false;
    let lastTs = null;

    // ---------- ðŸ§  Local Storage Helpers ----------
    function saveState() {
      const state = {
        mode,
        duration,
        remaining,
        elapsed,
        running,
        lastTs: running ? Date.now() : null
      };
      localStorage.setItem('workTimerState', JSON.stringify(state));
    }

    function loadState() {
      const state = localStorage.getItem('workTimerState');
      if (!state) return;
      try {
        const s = JSON.parse(state);
        mode = s.mode || 'countdown';
        duration = s.duration || 0;
        remaining = s.remaining || 0;
        elapsed = s.elapsed || 0;
        running = false; // always pause on load for safety
        lastTs = null;
      } catch (e) {
        console.error('Failed to load timer state:', e);
      }
    }

    function clearState() {
      localStorage.removeItem('workTimerState');
    }

    // Formatter
    function fmt(s) {
      s = Math.max(0, Math.floor(s));
      const hh = String(Math.floor(s / 3600)).padStart(2, '0');
      const mm = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
      const ss = String(s % 60).padStart(2, '0');
      return `${hh}:${mm}:${ss}`;
    }

    function render() {
      if (mode === 'countdown') display.textContent = fmt(remaining);
      else display.textContent = fmt(elapsed);

      if (mode === 'countdown') {
        status.textContent = !running && remaining === 0 ? 'Ready â€” set a duration and press Start.' : running ? 'Running (countdown)...' : 'Paused.';
      } else {
        status.textContent = !running && elapsed === 0 ? 'Stopwatch ready â€” press Start.' : running ? 'Running (stopwatch)...' : 'Paused.';
      }
      modeName.textContent = mode === 'countdown' ? 'Countdown' : 'Stopwatch';
      switchModeBtn.textContent = mode === 'countdown' ? 'Switch to Stopwatch' : 'Switch to Countdown';
      countdownControls.style.display = mode === 'countdown' ? 'flex' : 'none';
      document.getElementById('quickButtons').style.display = mode === 'countdown' ? 'flex' : 'none';

      saveState(); // ðŸ§  save after every render
    }

    function setDurationFromInputs() {
      const h = parseInt(hoursInput.value) || 0;
      const m = parseInt(minutesInput.value) || 0;
      duration = h * 3600 + m * 60;
      remaining = duration;
      render();
    }

    setBtn.addEventListener('click', () => {
      setDurationFromInputs();
      pauseTimer();
    });

    function startTimer() {
      if (running) return;
      if (mode === 'countdown') {
        if (remaining <= 0) {
          setDurationFromInputs();
          if (remaining <= 0) { status.textContent = 'Set a duration greater than 0.'; return; }
        }
      }
      running = true;
      lastTs = Date.now();
      timer = setInterval(tick, 250);
      render();
    }

    function pauseTimer() {
      if (timer) { clearInterval(timer); timer = null; }
      running = false;
      lastTs = null;
      render();
    }

    function resetTimer() {
      pauseTimer();
      if (mode === 'countdown') {
        remaining = duration;
      } else {
        elapsed = 0;
      }
      render();
    }

    function tick() {
      const now = Date.now();
      const dt = (now - lastTs) / 1000;
      if (dt >= 0.5) {
        const seconds = Math.floor(dt);
        lastTs += seconds * 1000;
        if (mode === 'countdown') {
          remaining -= seconds;
          if (remaining <= 0) {
            remaining = 0;
            doneBehavior();
          }
        } else {
          elapsed += seconds;
        }
        render();
      }
    }

    function doneBehavior() {
      pauseTimer();
      render();
      status.textContent = 'Done â€” timer reached zero.';
      flashDone();
      notifyUser('Countdown finished');
    }

    // Quick adds
    add15.addEventListener('click', () => { remaining += 900; duration += 900; render(); });
    add30.addEventListener('click', () => { remaining += 1800; duration += 1800; render(); });
    add60.addEventListener('click', () => { remaining += 3600; duration += 3600; render(); });

    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);

    switchModeBtn.addEventListener('click', () => {
      pauseTimer();
      mode = mode === 'countdown' ? 'stopwatch' : 'countdown';
      if (mode === 'countdown' && duration === 0) setDurationFromInputs();
      render();
      notifyUser('Mode switched to ' + mode);
    });

    function notifyUser(text) {
      if (navigator.vibrate) try { navigator.vibrate([60]); } catch (e) { }
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 880;
        g.gain.value = 0.02;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(() => { o.stop(); ctx.close(); }, 180);
      } catch (e) { }
    }

    function flashDone() {
      const origColor = display.style.color;
      let t = 0;
      const id = setInterval(() => {
        display.style.color = t % 2 ? '#000' : '#fff';
        display.style.background = t % 2 ? '#fff' : 'transparent';
        t++;
        if (t > 6) {
          clearInterval(id);
          display.style.color = origColor || '';
          display.style.background = 'transparent';
        }
      }, 160);
    }

    // -------- Init --------
    (function init() {
      loadState(); // ðŸ§  load saved state first
      render();

      try {
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(() => { });
        }
      } catch (e) { }
    })();

    // Keyboard shortcuts
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') { e.preventDefault(); if (running) pauseTimer(); else startTimer(); }
      if (e.key === 'r' || e.key === 'R') resetTimer();
      if (e.key === '+') { if (mode === 'countdown') add15.click(); }
    });

    // Save before unload (for accuracy)
    window.addEventListener('beforeunload', saveState);
  </script>

</body>

</html>